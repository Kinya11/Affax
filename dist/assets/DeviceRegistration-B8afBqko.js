import{_ as N,r as c,u as k,B as R,E as g,H as m,k as v,I as f,a as D,o as h,b as t,d as b,w as B,v as M,t as I,f as S,g as V,h as C,i as E,n as P}from"./index-MhNgPpDQ.js";import{I as T}from"./InvertedButton-DCGMtpo3.js";const q={class:"form-group"},z={class:"platform-info"},F={class:"actions"},H={key:0,class:"error-message"},L={__name:"DeviceRegistration",props:{theme:{type:String,default:"light"}},emits:["registered"],setup(_,{emit:y}){const w=y,d=c(""),u=c(navigator.platform.includes("Win")?"windows":navigator.platform.includes("Mac")?"macos":"linux"),l=c(!1),r=c(""),n=k(),x=async()=>{var i,e,s,o;try{l.value=!0,r.value="";const a=g()||m(),p=await v.post("/api/devices/register",{deviceId:a,deviceName:d.value,platform:u.value});p.data.success&&(f(a),w("registered",p.data.details),n.push("/app-list"))}catch(a){console.error("Device registration error:",a),((i=a.response)==null?void 0:i.status)===429?r.value="Device limit reached. Please deactivate an existing device first.":((e=a.response)==null?void 0:e.status)===401?(localStorage.removeItem("token"),n.push("/sign-in")):r.value=((o=(s=a.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to register device"}finally{l.value=!1}};return R(async()=>{var e;const i=g()||m();console.log("DeviceRegistration mounted, deviceId:",i);try{if((await v.get("/api/devices")).data.devices.length>0){const{data:o}=await v.get("/api/devices/check",{headers:{"X-Device-ID":i}});if(console.log("Device check response:",o),o.registered){f(o.deviceId),console.log("Device already registered, redirecting to app list"),n.push("/app-list");return}}}catch(s){console.error("Device check failed:",s),((e=s.response)==null?void 0:e.status)===401&&n.push("/sign-in")}}),(i,e)=>(h(),D("div",{class:P(["device-registration",_.theme])},[e[3]||(e[3]=t("h2",null,"Device Registration",-1)),t("form",{onSubmit:E(x,["prevent"])},[t("div",q,[e[1]||(e[1]=t("label",{for:"deviceName"},"Device Name",-1)),B(t("input",{id:"deviceName","onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),type:"text",placeholder:"Enter device name",required:""},null,512),[[M,d.value]])]),t("div",z,[t("span",null,"Platform detected: "+I(u.value),1)]),t("div",F,[S(T,{type:"submit",loading:l.value},{default:V(()=>e[2]||(e[2]=[C(" Register Device ")])),_:1},8,["loading"])]),r.value?(h(),D("div",H,I(r.value),1)):b("",!0)],32)],2))}},X=N(L,[["__scopeId","data-v-dbd3f4f7"]]);export{X as default};

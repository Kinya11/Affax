import{_ as J,c as te,r as v,a as x,o as y,b as d,n as k,d as N,t as P,w as ie,v as me,F as ne,e as re,f as F,g as T,h as q,i as K,j as ee,k as R,l as Pe,m as he,p as Me,u as ge,q as de,s as we,P as oe,x as De,y as ye,z as Be,A as Fe,B as Ne,C as Te,D as Re,N as ze,M as Ve,E as qe}from"./index-MhNgPpDQ.js";import{B as Y}from"./BlueGrayButton-Dgqwlr8P.js";import{I as ce}from"./InvertedButton-DCGMtpo3.js";const Oe="/assets/Firefox_logo__2019-CBhjG4N-.svg",Ue="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Background%20rectangle%20with%20rounded%20corners%20--%3e%3crect%20width='48'%20height='48'%20rx='8'%20fill='%231976D2'/%3e%3c!--%20Play%20triangle%20--%3e%3cpath%20d='M16%2014V34L36%2024L16%2014Z'%20fill='white'/%3e%3c/svg%3e",Ge={class:"app-content"},We=["src"],He={class:"app-info"},je={class:"app-name"},Ke={key:0,class:"app-description"},Ye={class:"app-size"},Je=["disabled"],Qe={__name:"AddedApp",props:{app:{type:Object,required:!0},theme:{type:String,default:"light"},listId:{type:Number,required:!0},disabled:{type:Boolean,default:!1}},emits:["delete-app"],setup(c,{emit:m}){const $=c,r=m,h=5001,f=te(()=>{var g,I;return(g=$.app.name)!=null&&g.toLowerCase().includes("firefox")?Oe:(I=$.app.name)!=null&&I.toLowerCase().includes("media player")?Ue:$.app.icon_url?$.app.icon_url.startsWith("http")?$.app.icon_url:`https://affax.app:${h}${$.app.icon_url}`:"/default-app-icon.png"});function s(g){g.target.src="/default-app-icon.png"}function _(g){return g?`${(g/1024).toFixed(1)} MB`:"0 MB"}const n=v(!1),w=()=>{$.disabled||(n.value=!0,setTimeout(()=>{r("delete-app",{listId:$.listId,appId:$.app.app_id})},150))};return(g,I)=>(y(),x("div",{class:k(["added-app",[c.theme,{deleting:n.value}]])},[d("div",Ge,[d("img",{src:f.value,class:k(["app-icon",c.theme]),onError:s,alt:"App icon"},null,42,We),d("div",He,[d("h3",je,P(c.app.name),1),c.app.description?(y(),x("p",Ke,P(c.app.description),1)):N("",!0),d("span",Ye,P(_(c.app.file_size_kb)),1)])]),d("button",{class:k(["delete-button",[c.theme,{disabled:c.disabled}]]),onClick:w,disabled:c.disabled}," × ",10,Je)],2))}},Xe=J(Qe,[["__scopeId","data-v-66710325"]]),Ze={class:"apps-list"},et={key:0,class:"empty-state"},tt=["onClick"],st={class:"app-details"},at=["src"],lt={class:"app-info"},ot={key:0,class:"app-description"},nt=["href"],rt={class:"app-size"},it={class:"modal-actions"},dt={__name:"AddAppsModal",props:{theme:{type:String,default:"light"}},emits:["close","apps-added"],setup(c,{expose:m,emit:$}){const r=$,h=v(!1),f=v(!1),s=v([]),_=v(""),n=v([]),w=v(!1),g=5001,I=te(()=>{if(!_.value)return s.value;const u=_.value.toLowerCase();return s.value.filter(a=>a.name.toLowerCase().includes(u)||a.description&&a.description.toLowerCase().includes(u))}),M=u=>u.icon_url?u.icon_url.startsWith("http")?u.icon_url:`http://localhost:${g}${u.icon_url}`:"/default-app-icon.png",z=async()=>{try{const u=await R.get("/api/apps");console.log("Raw API response:",u);let a=u.data;if(a.items)a=a.items;else if(!Array.isArray(a))if(a.apps)a=a.apps;else if(a.data)a=a.data;else{console.error("Unexpected API response format:",a),s.value=[];return}s.value=a.map(p=>({id:p.id,name:p.name||"Unnamed App",description:p.description||"",website:p.website||"#",icon_url:p.icon_url||"/default-app-icon.png",file_size_kb:p.file_size_kb||0})),console.log("Processed apps:",s.value)}catch(u){console.error("Error fetching apps:",u),s.value=[]}},C=u=>{const a=n.value.indexOf(u);a===-1?n.value.push(u):n.value.splice(a,1)},b=async()=>{if(!(n.value.length===0||w.value)){w.value=!0;try{r("apps-added",[...n.value]),D()}catch(u){console.error("Error submitting apps:",u)}finally{w.value=!1}}},A=async()=>{h.value=!0,n.value=[],_.value="",await z()},D=()=>{f.value=!0,setTimeout(()=>{h.value=!1,f.value=!1,r("close")},150)};return m({openModal:A,closeModal:D}),(u,a)=>h.value?(y(),x("div",{key:0,class:k(["modal-overlay",{"fade-out":f.value}]),onClick:K(D,["self"])},[d("div",{class:k(["modal-content",c.theme,{"fade-out":f.value}])},[a[3]||(a[3]=d("h1",{class:"modal-title"},"Add Apps",-1)),ie(d("input",{type:"text",class:k(["AppSearch",c.theme]),placeholder:"Search Apps...","onUpdate:modelValue":a[0]||(a[0]=p=>_.value=p),"aria-label":"Search apps"},null,2),[[me,_.value]]),d("div",Ze,[I.value.length===0?(y(),x("div",et,' No apps found matching "'+P(_.value)+'" ',1)):N("",!0),(y(!0),x(ne,null,re(I.value,p=>(y(),x("div",{key:p.id,class:k(["app-card",c.theme,{selected:n.value.includes(p.id)}]),onClick:E=>C(p.id)},[d("div",st,[d("img",{src:M(p),class:k(["app-icon",c.theme]),alt:"App icon",onError:a[1]||(a[1]=E=>E.target.src="/default-app-icon.png")},null,42,at),d("div",lt,[d("h3",null,P(p.name),1),p.description?(y(),x("p",ot,P(p.description),1)):N("",!0),p.website?(y(),x("a",{key:1,href:p.website,target:"_blank",class:"app-website"},P(p.website),9,nt)):N("",!0),d("p",rt,P((p.file_size_kb/1024).toFixed(1))+" MB ",1)])]),F(ce,{class:"add-button",onClick:K(E=>C(p.id),["stop"])},{default:T(()=>[q(P(n.value.includes(p.id)?"Added ✓":"Add"),1)]),_:2},1032,["onClick"])],10,tt))),128))]),d("div",it,[n.value.length>0?(y(),ee(Y,{key:0,onClick:b,disabled:w.value},{default:T(()=>[q(P(w.value?"Adding...":`Add ${n.value.length} App(s)`),1)]),_:1},8,["disabled"])):N("",!0),F(Y,{onClick:D},{default:T(()=>a[2]||(a[2]=[q(" Close ")])),_:1})])],2)],2)):N("",!0)}},ct=J(dt,[["__scopeId","data-v-f156fb0c"]]),ut={},pt={class:"red-button"};function vt(c,m){return y(),x("button",pt,[Pe(c.$slots,"default",{},void 0,!0)])}const ft=J(ut,[["render",vt],["__scopeId","data-v-e1e63f8f"]]),mt={class:"modal-buttons"},ht={__name:"ConfirmDeleteModal",props:{theme:{type:String,default:"light"},isInstalling:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(c,{expose:m,emit:$}){const r=$,h=v(!1);function f(){h.value=!0}function s(){h.value=!1}function _(){r("cancel"),s()}function n(){r("confirm"),s()}return m({openModal:f,closeModal:s}),(w,g)=>h.value?(y(),x("div",{key:0,class:"modal-overlay",onClick:_},[d("div",{class:k(["modal-content",c.theme]),onClick:g[0]||(g[0]=K(()=>{},["stop"]))},[g[3]||(g[3]=d("h3",null,"Are you sure you want to delete this list?",-1)),d("div",mt,[F(ft,{theme:c.theme,onClick:n,disabled:c.isInstalling,class:k({disabled:c.isInstalling})},{default:T(()=>g[1]||(g[1]=[q(" Yes, delete ")])),_:1},8,["theme","disabled","class"]),F(Y,{theme:c.theme,onClick:_},{default:T(()=>g[2]||(g[2]=[q(" No, keep this list ")])),_:1},8,["theme"])])],2)])):N("",!0)}},gt=J(ht,[["__scopeId","data-v-889dc4cb"]]),wt="data:image/svg+xml,%3csvg%20width='17'%20height='14'%20viewBox='0%200%2017%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='14.5887'%20height='1.83161'%20rx='0.915806'%20transform='matrix(0.565302%200.824884%20-0.720395%200.693564%201.31934%200)'%20fill='%23211A1D'/%3e%3crect%20width='14.5887'%20height='1.83161'%20rx='0.915806'%20transform='matrix(-0.565302%200.824884%200.720395%200.693564%2015.6807%200)'%20fill='%23211A1D'/%3e%3c/svg%3e",yt="data:image/svg+xml,%3csvg%20width='17'%20height='14'%20viewBox='0%200%2017%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='-0.0710175'%20y='0.695302'%20width='13.6729'%20height='0.915806'%20rx='0.457903'%20transform='matrix(0.565302%200.824884%20-0.720395%200.693564%201.78948%200.271647)'%20fill='%23211A1D'%20stroke='%23F8F9FF'%20stroke-width='0.915806'/%3e%3crect%20x='0.0710175'%20y='0.695302'%20width='13.6729'%20height='0.915806'%20rx='0.457903'%20transform='matrix(-0.565302%200.824884%200.720395%200.693564%2015.2908%200.154484)'%20fill='%23211A1D'%20stroke='%23F8F9FF'%20stroke-width='0.915806'/%3e%3c/svg%3e";function _t(c,m){const r=v((()=>{try{const f=sessionStorage.getItem(c);return f?JSON.parse(f):m}catch(f){return console.error(`Error reading sessionStorage key "${c}":`,f),m}})());return he(r,f=>{try{f==null?sessionStorage.removeItem(c):sessionStorage.setItem(c,JSON.stringify(f))}catch(s){console.error(`Error writing to sessionStorage key "${c}":`,s)}},{deep:!0}),{value:r,remove:()=>{try{sessionStorage.removeItem(c),r.value=m}catch(f){console.error(`Error removing sessionStorage key "${c}":`,f)}}}}const It={class:"install-button-container"},kt={key:0},bt={key:1},xt=Me({__name:"InstallButton",props:{listId:{},theme:{default:"light"}},emits:["install-progress","install-complete","install-error","install-request"],setup(c,{expose:m,emit:$}){const r=c,h=$;ge();const f=de(),s=v(!1),_=v(0),n=v(0),w=v(""),g=v(null),I=v(null),M=v(null),{remove:z}=_t("sudoPassword",null),C=(a,p)=>{var j,U,S;s.value=!1,z();const H=((j=a.message)==null?void 0:j.toLowerCase().includes("password"))||((U=a.message)==null?void 0:U.includes("sudo"))||((S=a.response)==null?void 0:S.status)===403?"Incorrect Password":p||"Installation failed";f.error(H,{timeout:5e3,position:oe.TOP_RIGHT,closeOnClick:!0}),h("install-error",H),u()},b=()=>{I.value&&clearInterval(I.value),I.value=setInterval(async()=>{try{if(!M.value)return;const{data:a}=await R.get(`/api/installations/${M.value}/status`);_.value=a.progress||0,n.value=a.total||0;const p=Math.floor(_.value/100*n.value);if(w.value=`Installing (${p}/${n.value})`,a.status==="completed")D(!0);else if(a.status==="failed"){const E=a.error||"Installation failed";console.error("Installation failed:",E),E.toLowerCase().includes("password")||E.includes("sudo")?C({message:E},"Incorrect Password"):C({message:E},E)}}catch(a){console.error("Polling error:",a),C(a,"Failed to check installation status")}},2e3)},A=async a=>{var p,E,H,j,U;try{s.value=!0,g.value=null,w.value="Starting installation...";const S=await R.post(`/api/lists/${r.listId}/install`,{sudoPassword:a});if(S.data.success&&S.data.installationId)M.value=S.data.installationId,n.value=S.data.totalApps||0,w.value=`Installing (0/${n.value})`,b(),f.info("Installation started...",{timeout:3e3,position:oe.TOP_RIGHT});else throw new Error(S.data.error||"Failed to start installation")}catch(S){console.error("Installation error:",S);const Z=(E=(p=S.response)==null?void 0:p.data)==null?void 0:E.errorCode,Q=(j=(H=S.response)==null?void 0:H.data)==null?void 0:j.error;Z==="INVALID_PASSWORD"||Q!=null&&Q.includes("Incorrect Password")||((U=S.response)==null?void 0:U.status)===403?C(S,"Incorrect Password"):C(S,"Installation failed to start"),u()}},D=(a,p)=>{I.value&&(clearInterval(I.value),I.value=null),s.value=!1,w.value=`Installing (${n.value}/${n.value})`,setTimeout(()=>{f.success("Installation completed successfully",{timeout:5e3,position:oe.TOP_RIGHT}),h("install-complete"),u()},1e3)},u=()=>{_.value=0,n.value=0,w.value="",g.value=null,s.value=!1,I.value&&(clearInterval(I.value),I.value=null)};return m({resetState:u,startInstallation:A}),we(()=>{u()}),(a,p)=>(y(),x("div",It,[F(Y,{disabled:s.value,onClick:p[0]||(p[0]=E=>a.$emit("install-request",r.listId)),class:k({loading:s.value})},{default:T(()=>[s.value?(y(),x("span",bt,P(w.value||"Starting..."),1)):(y(),x("span",kt,"Install"))]),_:1},8,["disabled","class"])]))}}),$t=J(xt,[["__scopeId","data-v-afe0055e"]]),Ct={class:"password-input-container"},At=["type"],Et=["aria-label"],St={key:0,class:"error-message"},Lt={class:"modal-actions"},Pt={__name:"SudoPasswordModal",props:{theme:{type:String,default:"light"}},emits:["confirm","cancel"],setup(c,{expose:m,emit:$}){const r=de(),h=$,f=v(!1),s=v(""),_=v(!1),n=v(""),w=v(!1),g=v(null),I=()=>{f.value=!0,s.value="",n.value="",_.value=!1,setTimeout(()=>{var b;(b=g.value)==null||b.focus()},100)},M=()=>{f.value=!1,s.value="",n.value=""},z=async()=>{var b,A,D;if(!s.value){n.value="Password is required",r.error("Password is required");return}w.value=!0;try{h("confirm",s.value),M()}catch(u){const a=((A=(b=u==null?void 0:u.response)==null?void 0:b.data)==null?void 0:A.message)||(u==null?void 0:u.message)||"Unknown error";((D=u==null?void 0:u.response)==null?void 0:D.status)===403||a.toLowerCase().includes("password")?(n.value="Incorrect Password",r.error("Incorrect Password")):(n.value="Failed to validate password",r.error("Failed to validate password"))}finally{w.value=!1}},C=()=>{h("cancel"),M()};return m({openModal:I,closeModal:M,isVisible:f}),he(f,b=>{b?document.body.style.overflow="hidden":document.body.style.overflow=""}),(b,A)=>f.value?(y(),x("div",{key:0,class:"modal-overlay",onClick:K(C,["self"])},[d("div",{class:k(["sudo-modal-content",c.theme])},[A[3]||(A[3]=d("h3",null,"Administrator Permission Required",-1)),A[4]||(A[4]=d("p",null,"Installing apps requires administrator privileges. Please enter your computer's password:",-1)),d("div",Ct,[ie(d("input",{"onUpdate:modelValue":A[0]||(A[0]=D=>s.value=D),type:_.value?"text":"password",placeholder:"Enter your password",onKeyup:ye(z,["enter"]),ref_key:"passwordInput",ref:g},null,40,At),[[De,s.value]]),d("button",{class:"toggle-visibility",onClick:A[1]||(A[1]=D=>_.value=!_.value),type:"button","aria-label":_.value?"Hide password":"Show password"},P(_.value?"👁️":"👁️‍🗨️"),9,Et)]),n.value?(y(),x("div",St,P(n.value),1)):N("",!0),d("div",Lt,[F(Y,{onClick:C,theme:c.theme},{default:T(()=>A[2]||(A[2]=[q(" Cancel ")])),_:1},8,["theme"]),F(ce,{onClick:z,disabled:!s.value||w.value,theme:c.theme},{default:T(()=>[q(P(w.value?"Verifying...":"Confirm"),1)]),_:1},8,["disabled","theme"])])],2)])):N("",!0)}},Mt=J(Pt,[["__scopeId","data-v-6b957491"]]),Dt={class:"app-list-container"},Bt={id:"applist-main-container"},Ft={id:"ai-tool-buttons",class:"tool-buttons-applist"},Nt={class:"list-container"},Tt=["onClick"],Rt={class:"top-flex-inline-div"},zt=["onUpdate:modelValue","onKeydown","onBlur","disabled"],Vt=["onClick"],qt=["src"],Ot={class:"top-right-div"},Ut={class:"size-span"},Gt={class:"app-list-content"},Wt={__name:"AppList",setup(c){const m=ge(),$=Be();Fe();const r=de(),h=v("light"),f=te(()=>h.value==="light"?wt:yt),s=v([]),_=v("New List"),n=v(0),w=v(null),g=v(null),I=v(null),M=v(null),z=v(null),C=v(null),b=v({}),A=(t,l)=>{t&&(b.value[l]=t)},D=()=>{I.value.closeModal(),w.value=null},u=t=>{b.value[t]&&b.value[t].resetState(),G.value=!1},a=(t,l)=>{G.value=!1,X.value=null},p=async()=>{var t;try{const l=qe(),e=localStorage.getItem("token");if(console.log("AppList checking device:",l),!e)return m.push("/sign-in"),!1;if(!l)return m.push("/device-register"),!1;const{data:o}=await R.get("/api/devices/check",{headers:{"X-Device-ID":l}});return console.log("Device check response:",o),o.registered?!0:(localStorage.removeItem("deviceId"),m.push("/device-register"),!1)}catch(l){return console.error("Device check failed:",l),((t=l.response)==null?void 0:t.status)===401&&(localStorage.removeItem("token"),m.push("/sign-in")),!1}};Ne(async()=>{try{if(await p()){await U();const l=$.query.expandList;l&&ue(Number(l))}else r.error("Failed to verify device. Please try again.")}catch(t){console.error("AppList mounting error:",t)}window.addEventListener("expand-list",pe)}),Te(()=>{window.removeEventListener("expand-list",pe)});function E(t){h.value=t}function H(t){const l=t.target;l.style.width=`${Math.max(l.value.length,1)}ch`}function j(t){s.value[t].isExpanded=!s.value[t].isExpanded,s.value[t].isExpanded&&(s.value[n.value]&&n.value!==t&&(s.value[n.value].isExpanded=!1),n.value=t)}async function U(){try{if(!localStorage.getItem("token")){m.push("/sign-in");return}const l=await R.get("/api/lists").catch(e=>{var o,i;throw(((o=e.response)==null?void 0:o.status)===401||((i=e.response)==null?void 0:i.status)===403)&&(localStorage.removeItem("token"),m.push("/sign-in")),e});if(!l.data||!Array.isArray(l.data))throw new Error("Invalid server response format");s.value=l.data.map(e=>({id:e.id,name:e.name,user_id:e.user_id,isExpanded:!1,isEditing:!1,apps:[],size:"0 GB"})),await Promise.allSettled(s.value.map(async(e,o)=>{var i,O;try{const{data:L}=await R.get(`/api/lists/${e.id}/items`);s.value[o].apps=(L==null?void 0:L.items)||L||[],Z(o)}catch(L){console.error(`Error loading apps for list ${e.id}:`,L),s.value[o].apps=[],Z(o),((i=L.response)==null?void 0:i.status)===401||((O=L.response)==null?void 0:O.status)===403?(localStorage.removeItem("token"),m.push("/sign-in")):r.error("Failed to load apps")}}))}catch(t){if(console.error("Failed to load lists:",t),t.response)switch(t.response.status){case 400:alert("Invalid request. Please try again.");break;case 401:case 403:localStorage.removeItem("token"),m.push("/sign-in");break;default:alert("Server error. Please try again later.")}else alert("Network error. Please check your connection.")}}async function S(){var l;const t=_.value.trim().substring(0,24);if(!t){r.error("List name cannot be empty");return}try{if(!localStorage.getItem("token")){m.push("/sign-in");return}const o=await R.post("/api/lists",{name:t}),i={id:o.data.id,name:o.data.name,user_id:o.data.user_id,isExpanded:!1,isEditing:!1,apps:[],size:"0 GB"};s.value.push(i),_.value="New List",window.dispatchEvent(new CustomEvent("list-created")),r.success("List created successfully")}catch(e){((l=e.response)==null?void 0:l.status)===403?r.error("You've reached your list limit",{timeout:8e3,onClick:()=>m.push("/upgrade-plan"),action:{text:"Upgrade Plan",onClick:()=>m.push("/upgrade-plan")}}):r.error("Failed to create list")}}function Z(t){const l=s.value[t].apps.reduce((e,o)=>e+(o.file_size_kb||0),0);s.value[t].size=`${(l/1048576).toFixed(2)} GB`}async function Q(t,l){if(B.value)return;const e=l.trim().substring(0,24);if(!e){alert("List name cannot be empty");return}try{if(!localStorage.getItem("token")){m.push("/sign-in");return}await R.put(`/api/lists/${s.value[t].id}`,{name:e}),s.value[t].name=e,s.value[t].isEditing=!1,window.dispatchEvent(new CustomEvent("list-updated"))}catch(o){be(o,"Failed to update list name")}}async function _e(){var e,o;if(w.value===null)return;const t=w.value,l=(e=s.value[t])==null?void 0:e.id;if(!l){console.error("No list ID found for deletion");return}try{const i=s.value.splice(t,1)[0];n.value>=t&&(n.value=Math.max(0,n.value-1)),I.value.closeModal(),w.value=null,await R.delete(`/api/lists/${l}`),window.dispatchEvent(new CustomEvent("list-deleted"))}catch(i){s.value.splice(t,0,deletedList),console.error("Delete failed:",i),i.response?i.response.status===401?m.push("/sign-in"):alert(`Delete failed: ${((o=i.response.data)==null?void 0:o.message)||"Server error"}`):alert("Network error - could not delete list")}}const Ie=async t=>{var l,e,o,i,O,L,W,ve;if(M.value)try{const V=Array.isArray(t)?t:[t];if(V.length===0){r.warning("Please select at least one app");return}const fe=s.value.findIndex(le=>le.id===M.value),Le=fe!==-1?s.value[fe].isExpanded:!1,Ht=await R.post(`/api/lists/${M.value}/items`,{appIds:V});g.value.closeModal(),await U();const ae=s.value.findIndex(le=>le.id===M.value);ae!==-1&&Le&&(s.value[ae].isExpanded=!0,n.value=ae)}catch(V){console.error("Error adding apps:",V),((l=V.response)==null?void 0:l.status)===400?((e=V.response.data)==null?void 0:e.errorCode)==="INVALID_PASSWORD"||(i=(o=V.response.data)==null?void 0:o.error)!=null&&i.toLowerCase().includes("password")?r.error("Incorrect Password"):(L=(O=V.response.data)==null?void 0:O.error)!=null&&L.includes("already in the list")?r.warning("Selected apps are already in the list"):r.error(((W=V.response.data)==null?void 0:W.error)||"Failed to add apps"):((ve=V.response)==null?void 0:ve.status)===403?r.error("Incorrect Password"):r.error("Failed to add apps. Please try again.")}},ke=async({listId:t,appId:l})=>{if(!(B.value||X.value===t))try{await R.delete(`/api/lists/${t}/items/${l}`);const e=s.value.findIndex(o=>o.id===t);e!==-1&&(s.value[e].apps=s.value[e].apps.filter(o=>o.app_id!==l),Z(e))}catch(e){console.error("Error deleting app:",e),r.error("Failed to delete app")}};function be(t,l){var e,o,i;console.error("API Error:",t),((e=t.response)==null?void 0:e.status)===401?m.push("/sign-in"):r.error(((i=(o=t.response)==null?void 0:o.data)==null?void 0:i.message)||l)}const xe=t=>{B.value||(M.value=t,g.value.openModal())},G=v(!1),X=v(null),$e=t=>{B.value||(w.value=t,I.value.openModal())},se=v(null),Ce=async(t,l)=>{var e,o,i,O,L;try{if(!b.value[t]){r.error("Installation component not found");return}if(G.value=!0,X.value=t,typeof b.value[t].startInstallation!="function"){r.error("Installation method not available");return}await b.value[t].startInstallation(l)}catch(W){if(console.error("Installation failed:",W),a(),((e=W.response)==null?void 0:e.status)===403){if(((o=W.response.data)==null?void 0:o.errorCode)==="DEVICE_NOT_REGISTERED"){r.warning("Device needs to be registered"),m.push("/device-register");return}if((O=(i=W.response.data)==null?void 0:i.error)!=null&&O.toLowerCase().includes("password")||(L=W.message)!=null&&L.toLowerCase().includes("password")){r.error("Incorrect Password");return}r.error("Access denied")}else r.error("Installation failed")}finally{G.value=!1,X.value=null}},Ae=t=>{C.value=t,z.value.openModal()},Ee=t=>{C.value&&(Ce(C.value,t),z.value.closeModal())},Se=()=>{C.value=null,G.value=!1,C.value&&b.value[C.value]&&b.value[C.value].resetState()},ue=(t,l=!1)=>{const e=s.value.findIndex(o=>o.id===t);e!==-1&&(s.value[n.value]&&(s.value[n.value].isExpanded=!1),s.value[e].isExpanded=!0,n.value=e,l&&Re(()=>{const o=document.querySelector(`[data-list-id="${t}"]`);if(o){const L=o.getBoundingClientRect().top+window.pageYOffset-60-20;window.scrollTo({top:L,behavior:"smooth"})}}))},pe=t=>{const{listId:l,shouldScroll:e}=t.detail;ue(Number(l),e)};we(()=>{se.value&&(clearInterval(se.value),se.value=null),G.value=!1,C.value=null});const B=te(()=>G.value||X.value!==null);return(t,l)=>(y(),x("div",Dt,[F(ze,{onToggled:E}),d("div",Bt,[d("h1",{id:"my-list-h",class:k(h.value)},"Dashboard",2),d("div",Ft,[F(Y,{onClick:S,theme:h.value},{default:T(()=>l[0]||(l[0]=[q(" New List ")])),_:1},8,["theme"])]),(y(!0),x(ne,null,re(s.value,(e,o)=>(y(),ee(Ve,{key:e.id,"data-list-id":e.id,class:k(["glassmorphic-container-applist-main","list-wrapper",h.value])},{default:T(()=>[d("div",Nt,[d("div",{class:"hitbox",onClick:i=>j(o)},null,8,Tt),d("div",{class:k(["container-top-flex",h.value])},[d("div",Rt,[e.isEditing?ie((y(),x("input",{key:0,"onUpdate:modelValue":i=>e.name=i,onKeydown:ye(i=>Q(o,e.name),["enter"]),onBlur:i=>Q(o,e.name),class:k(["list-name-input",[h.value,{disabled:B.value}]]),onInput:H,maxlength:"24",disabled:B.value},null,42,zt)),[[me,e.name]]):(y(),x("span",{key:1,onClick:K(i=>!B.value&&(e.isEditing=!0),["stop"]),class:k(["list-name",{disabled:B.value}])},P(e.name),11,Vt)),d("img",{class:k(["arrow-icon",{rotated:e.isExpanded}]),src:f.value,alt:"Toggle list"},null,10,qt)]),d("div",Ot,[d("span",Ut,P(e.size),1),F($t,{ref_for:!0,ref:i=>A(i,e.id),listId:e.id,theme:h.value,onInstallComplete:i=>u(e.id),onInstallError:i=>a(i,e.id),onInstallRequest:Ae},null,8,["listId","theme","onInstallComplete","onInstallError"])])],2),d("div",{class:k(["app-list",{expand:e.isExpanded,collapse:!e.isExpanded}])},[d("div",Gt,[(y(!0),x(ne,null,re(e.apps,i=>(y(),ee(Xe,{key:i.app_id,app:i,theme:h.value,"list-id":e.id,disabled:B.value||X.value===e.id,onDeleteApp:ke},null,8,["app","theme","list-id","disabled"]))),128)),e.apps.length===0?(y(),x("div",{key:"empty-"+e.id,class:"empty-list-message"}," No apps in this list yet ")):N("",!0)])],2),d("div",{id:"tool-buttons-applist-bottom",class:k({expand:e.isExpanded,collapse:!e.isExpanded})},[e.isExpanded?(y(),ee(Y,{key:0,id:"add-apps-button",onClick:K(i=>xe(e.id),["stop"]),disabled:B.value,class:k({disabled:B.value})},{default:T(()=>l[1]||(l[1]=[q(" Add Apps ")])),_:2},1032,["onClick","disabled","class"])):N("",!0),e.isExpanded?(y(),ee(ce,{key:1,onClick:K(i=>$e(o),["stop"]),disabled:B.value,class:k({disabled:B.value})},{default:T(()=>l[2]||(l[2]=[q(" Delete List ")])),_:2},1032,["onClick","disabled","class"])):N("",!0)],2)])]),_:2},1032,["data-list-id","class"]))),128))]),F(ct,{ref_key:"addAppsModal",ref:g,theme:h.value,onAppsAdded:Ie},null,8,["theme"]),F(gt,{ref_key:"confirmDeleteModal",ref:I,theme:h.value,isInstalling:G.value,onConfirm:_e,onCancel:D},null,8,["theme","isInstalling"]),F(Mt,{ref_key:"sudoPasswordModal",ref:z,theme:h.value,onConfirm:Ee,onCancel:Se},null,8,["theme"])]))}},Jt=J(Wt,[["__scopeId","data-v-48fc57d6"]]);export{Jt as default};

import{_ as x,r,a as m,d as f,o as d,b as t,t as u,i as D,u as U,A as G,B as P,G as M,j as N,f as V,w as y,v as I,y as S,g as z,h as E,F,k as _,E as R,H as O,I as q}from"./index-MhNgPpDQ.js";import{B as K}from"./BlueGrayButton-Dgqwlr8P.js";const L="/assets/ScracthyWallpaper-DQgfkkp7.png",k="data:image/svg+xml,%3csvg%20width='242'%20height='9'%20viewBox='0%200%20242%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20filter='url(%23filter0_d_349_59)'%3e%3cline%20x1='4'%20y1='4.5'%20x2='238'%20y2='4.50002'%20stroke='%23060606'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='filter0_d_349_59'%20x='0'%20y='0'%20width='242'%20height='9'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20type='matrix'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset/%3e%3cfeGaussianBlur%20stdDeviation='2'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20type='matrix'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%201%200'/%3e%3cfeBlend%20mode='normal'%20in2='BackgroundImageFix'%20result='effect1_dropShadow_349_59'/%3e%3cfeBlend%20mode='normal'%20in='SourceGraphic'%20in2='effect1_dropShadow_349_59'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",$={class:"modal-content"},J={__name:"SignInModal",props:["title","message"],emits:["close"],setup(g,{emit:l}){const c=l,i=r(!0),n=()=>{i.value=!1,c("close")};return(o,p)=>i.value?(d(),m("div",{key:0,class:"modal-overlay",onClick:D(n,["self"])},[t("div",$,[t("h3",null,u(g.title),1),t("p",null,u(g.message),1),t("button",{onClick:n},"Close")])])):f("",!0)}},T=x(J,[["__scopeId","data-v-3836a697"]]),j={class:"sign-in-page"},H={class:"sign-in-container"},Q={key:0,class:"error-message"},W={class:"input-label"},X={class:"input-label"},Y={__name:"SignIn",setup(g){const l=U(),c=r(""),i=r(""),n=r(!1),o=r(""),p=r(!1),h=G(),B=async()=>{console.log("Initializing Google Auth...");try{await new Promise(s=>{const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.onload=s,document.head.appendChild(e)}),window.google.accounts.id.initialize({client_id:"711103315993-s2dnac7v6uti2d6hamc9mdicek7c3dmq.apps.googleusercontent.com",callback:b}),window.google.accounts.id.renderButton(document.getElementById("googleSignInDiv"),{theme:"outline",size:"large",width:250}),console.log("Google Auth initialized successfully")}catch(s){console.error("Failed to initialize Google Auth:",s)}},b=async s=>{try{n.value=!0,o.value="";const e=R(),a=await _.post("/api/auth/google-login",{id_token:s.credential,deviceId:e||O()});a.data.token&&(localStorage.setItem("token",a.data.token),a.data.user&&(localStorage.setItem("user",JSON.stringify(a.data.user)),h.setUser(a.data.user)),!e&&a.data.deviceId&&q(a.data.deviceId),!e&&a.data.requiresDeviceRegistration?l.push({name:"DeviceRegister"}):l.push({name:"AppList"}))}catch(e){w(e)}finally{n.value=!1}};P(()=>{console.log("SignIn component mounted"),B()});const A=s=>{localStorage.setItem("token",s.data.token),s.data.user&&(localStorage.setItem("user",JSON.stringify(s.data.user)),h.setUser(s.data.user)),s.data.requiresDeviceRegistration?l.push("/device-register"):localStorage.getItem("deviceId")?l.push("/app-list"):l.push("/device-register")},v=async()=>{try{n.value=!0,o.value="";const s=await _.post("/api/auth/login",{email:c.value,password:i.value});A(s)}catch(s){w(s)}finally{n.value=!1}},w=s=>{if(console.error("Authentication error:",s),s.response)switch(s.response.status){case 400:o.value="Invalid request format";break;case 401:o.value="Invalid email or password";break;case 404:o.value="User not found";break;case 500:o.value="Server error. Please try again later";break;default:o.value="An error occurred. Please try again."}else o.value="Network error. Please check your connection"},C=()=>{l.push({name:"SignUp"})};return(s,e)=>(d(),m(F,null,[e[9]||(e[9]=t("img",{src:L,class:"wallpaper"},null,-1)),t("nav",null,[e[3]||(e[3]=t("img",{class:"Logo",src:M,alt:"append logo",width:"40px"},null,-1)),e[4]||(e[4]=t("div",{class:"nav-element",id:"nav-center"},null,-1)),t("span",{class:"nav-element-container"},[t("div",{class:"dropdown-actuator"},[t("span",{onClick:C,class:"nav-element",id:"sign-up"}," Sign Up ")])])]),t("div",j,[t("div",H,[e[5]||(e[5]=t("h1",null,"Sign In",-1)),e[6]||(e[6]=t("p",null,"Sign in using your email or password",-1)),o.value?(d(),m("div",Q,u(o.value),1)):f("",!0),t("label",W,[y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),id:"email-input",class:"sign-in-input",placeholder:"Email",onKeyup:S(v,["enter"])},null,544),[[I,c.value]])]),t("label",X,[y(t("input",{type:"password","onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),id:"password-input",class:"sign-in-input",placeholder:"Password",onKeyup:S(v,["enter"])},null,544),[[I,i.value]])]),V(K,{id:"sign-in-button",onClick:v,disabled:n.value},{default:z(()=>[E(u(n.value?"Signing In...":"Sign In"),1)]),_:1},8,["disabled"]),e[7]||(e[7]=t("div",{class:"or"},[t("img",{src:k,alt:"line"}),t("p",null,"Or"),t("img",{src:k,alt:"line"})],-1)),e[8]||(e[8]=t("div",{id:"googleSignInDiv",class:"google-sign-in-button"},null,-1))]),p.value?(d(),N(T,{key:0,title:"Account Issue",message:"Account does not exist. Please create an account first.",onClose:e[2]||(e[2]=a=>p.value=!1)})):f("",!0)])],64))}},te=x(Y,[["__scopeId","data-v-99e90d14"]]);export{te as default};
